= DIY State Graph

APIgee EDGE system has many components. EDGE is a sophisticated and complex distributed system. EDGE has evolved over a few years, a few revisions and a few teams to serve its functionality. Current state of the tools and system do not maintain consistent view of the system state.
More details at : https://apigeesc.atlassian.net/wiki/display/EH/DevOpsSystem-DIA
'''

*Table of Contents*


'''

=== DIY State Graph


=== Database Setup

Below you will find the full Cypher script for creating DIY satate graph. This simple script is the full setup of the data set that we will later perform analysis on.

//setup
[source,cypher]
----
// Create Customer
CREATE (Walgreens:Customer { 
			id:'Customer1', 
			name:'Walgreens',
			AccountType: 'CLOUD',
			Provider: 'AWS',
			isActive : 'ACTIVE' }) 
	
	
		
//Create organization
CREATE (Developer_org:Organization { 
			id:'org1', 
			name:'Developer' })

CREATE (Internal_org:Organization { 
			id:'org12', 
			name:'Internal' })


		
//Create Environment
CREATE(Env_test:Environment{
			id:"walTest",
			name: "Test" 
})


CREATE(Env_prod:Environment{
			id:"walProd",
			name: "Production" 
})

		
//create Order
CREATE (Order_Edge250:FinanceOrder { 
			id:'Order123', 
			name:'Order_Edge250',
			SLA:'25M/quater' 
		}) 

CREATE (Order_APIBAAS250:FinanceOrder { 
			id:'Order456', 
			name:'Order_APIBAAS250',
			SLA:'25M/quater' 
		})
		
CREATE (Order_DeveloperService250:FinanceOrder { 
			id:'Order789', 
			name:'Order_DeveloperService250',
			SLA:'1000 users' 
		})
		
CREATE (Order_AnalyticsService250:FinanceOrder { 
			id:'Order1011', 
			name:'Order_AnalyticsService250',
			SLA:'1TBStorage/quater' 
		})	
//create product
CREATE (Edge:Product { 
			id:'Edge', 
			name:'Edge'
		})
CREATE (Insight:Product { 
			id:'Insights', 
			name:'Insights'
		})
		
		
//create Product Instance

CREATE (Edge250:ProductInstance { 
			id:'Edge250', 
			name:'Edge250',
			SLA:'25M calls /quater' 
		})
		
CREATE (Edge500:ProductInstance { 
			id:'Edge500', 
			name:'Edge500',
			SLA:'50M calls /quater' 
		})

CREATE (Edge1250:ProductInstance { 
			id:'Edge1250',
			name:'Edge1250',
			SLA:'1250M calls /quater' 
		})
		
CREATE (Insights250:ProductInstance { 
			id:'Insight3', 
			name:'Insights250',
			SLA:'1TB /quater' 
		})
		

//create SKU		
CREATE (E250_Edge250:SKU { 
			id:'sku250',
			name:'Edge 250' 
		})
		
CREATE (E2520_EnterpriseFeaturePack:SKU { 
			id:'sku2520',
			name:'Enterprise Feature pack' 
		})
		
CREATE (E25040_Monetization:SKU { 
			id:'sku25040',
			name:'Monetization Pack' 
		})

CREATE (I100_InsightsCTM:SKU { 
			id:'skuI100',
			name:'Insights CTM Cloud' 
		})
		
// create Proxy Bundle

CREATE (APIPlatform:proxy_bundle { 
			id:'proxy1',
			name:'APIPlatform' 
		})
		
CREATE (APIBAAS:proxy_bundle { 
			id:'proxy2',
			name:'API BAAS' 
		})
		
CREATE (AnalyticsService:proxy_bundle { 
			id:'proxy3',
			name:'Analytics Service' 
		})
		
		
//Create Component
CREATE (Message_Processor:Component { 
			id:'comp1',
			name:'Message Processor',
			type:'Dedicated' 
		})
CREATE (Router:Component { 
			id:'comp2',
			name:'Router',
			type:'Shared' 
		})

CREATE (Dynect:Component { 
			id:'comp3',
			name:'Dynect',
			type:'Shared' 
		})

CREATE (ELB:Component { 
			id:'comp4',
			name:'ELB',
			type:'Dedicated' 
		})

CREATE (Cassandra:Component { 
			id:'comp5',
			name:'Cassandra',
			type:'Shared' 
		})
		
CREATE (UserGrid_tomcat:Component { 
			id:'comp6',
			name:'tomcat',
			type:'Dedicated' 
		})		
CREATE (UserGrid_Cassandra:Component { 
			id:'comp7',
			name:'User grid Cassandra',
			type:'Shared'
		})

//create provider		
CREATE (AWS:Provider {
			id:'provider-aws',
			name:'AWS',
			Type:"public"
		})
CREATE (RackSpace:Provider {
			id:'provider-rackspace',
			name:'RackSpace',
			Type:"private"
		})


//create Compute/storage/network Instance Type
CREATE (c3xlarge:ComputeInstance {
			id:'aws-instance1',
			UUID:'ABCD',
			Type:'compute',
			Size:'Xlarge',
			vCpu:'4',
			Memory:'7.5GB',
			SSD:'2X40'
			
		})
CREATE (i2xlarge:ComputeInstance {
			id:'aws-instance2',
			UUID:'ABCDE',
			Type:'Storage',
			Size:'Xlarge',
			vCpu:'4',
			Memory:'20GB',
			SSD:'1X800'
			
		})
		
CREATE (r1large:ComputeInstance {
			id:'rackspace-instance3',
			UUID:'ABCDF',
			Type:'compute',
			Size:'large',
			vCpu:'4',
			Memory:'8GB',
			SSD:'1X40'
			
		})		

//Connect customer to orgs
CREATE (Developer_org)-[:BELONG_TO]->(Walgreens)

CREATE (Internal_org)-[:BELONG_TO]->(Walgreens)

//Connect org to product instance
CREATE (Developer_org)-[:uses]->(Edge500)
CREATE (Developer_org)-[:uses]->(Insights250)
CREATE (Internal_org)-[:uses]->(Edge250)

//Connect Environment to org
CREATE (Env_prod)-[:SUPPORTED_IN]->(Developer_org)

CREATE (Env_test)-[:SUPPORTED_IN]->(Developer_org)

CREATE (Env_prod)-[:SUPPORTED_IN]->(Internal_org)

//Connect Order to customer

CREATE (Order_Edge250)-[:PLACED_FOR]->(Walgreens)
CREATE (Order_APIBAAS250)-[:PLACED_FOR]->(Walgreens)

CREATE (Order_DeveloperService250)-[:PLACED_FOR]->(Walgreens)

CREATE (Order_AnalyticsService250)-[:PLACED_FOR]->(Walgreens)

// connect customer with product
CREATE (Walgreens)-[:USES]->(Edge250)

//Connect product instance with product TODO:add sla in connection property

CREATE (Edge250)-[:INSTANCE_OF {SLA:'250M/Quater' }]->(Edge)

CREATE (Edge500)-[:INSTANCE_OF {SLA:'500M/Quater' }]->(Edge)

CREATE (Edge1250)-[:INSTANCE_OF {SLA:'1250M/Quater' }]->(Edge)

CREATE (Insights250)-[:INSTANCE_OF {SLA:'1TB/Quater' }]->(Insight)

//connect SKU to product instance
CREATE (Edge250)-[:OFFERS]->(E250_Edge250)

CREATE (Edge250)-[:OFFERS]->(E2520_EnterpriseFeaturePack)

CREATE (Edge250)-[:OFFERS]->(E25040_Monetization)

CREATE (Insights250)-[:OFFERS]->(I100_InsightsCTM)

//connect proxy bundle with SKU

CREATE (APIPlatform)-[:BUNDLES {Quantity:'2'}]->(Message_Processor)-[:SERVES]->(Edge250)

CREATE (APIPlatform)-[:BUNDLES {Quantity:'4'}]->(Message_Processor)-[:SERVES]->(Edge500)

CREATE (APIPlatform)-[:BUNDLES {Quantity:'2'}]->(Router)-[:SERVES]->(Edge250)

CREATE (APIPlatform)-[:BUNDLES {Quantity:'4'}]->(Router)-[:SERVES]->(Edge500)

CREATE (APIPlatform)-[:BUNDLES {Quantity:'1'}]->(Dynect)-[:SERVES]->(Edge250)

CREATE (APIPlatform)-[:BUNDLES {Quantity:'1'}]->(Dynect)-[:SERVES]->(Edge500)

CREATE (APIPlatform)-[:BUNDLES {Quantity:'2'}]->(ELB)-[:SERVES]->(Edge250)

CREATE (APIPlatform)-[:BUNDLES {Quantity:'2'}]->(ELB)-[:SERVES]->(Edge500)

CREATE (APIPlatform)-[:BUNDLES {Quantity:'6'}]->(Cassandra)-[:SERVES]->(Edge250)

CREATE (APIPlatform)-[:BUNDLES {Quantity:'6'}]->(Cassandra)-[:SERVES]->(Edge500)

CREATE (APIBAAS)-[:BUNDLES {Quantity:'2'}]->(UserGrid_tomcat)-[:SERVES]->(Edge250)

CREATE (APIBAAS)-[:BUNDLES {Quantity:'4'}]->(UserGrid_tomcat)-[:SERVES]->(Edge500)

CREATE (APIBAAS)-[:BUNDLES {Quantity:'2'}]->(UserGrid_Cassandra)-[:SERVES]->(Edge250)

CREATE (APIBAAS)-[:BUNDLES {Quantity:'4'}]->(UserGrid_Cassandra)-[:SERVES]->(Edge500)


RETURN *

----

'''

=== Interactive Graph Visualization
//graph

'''
=== Queries to the graph

